jQuery(document).ready(function(l){var e=window.parent.TvrMT,s=e.TvrUi,a=e.TvrCom,d=(e.tvrsprintf,window.parent.TvrLang);s.templates=e.data.templates;var c={init:function(){e.data.prog.combo.packTypes=[d.theme_skin,d.plugin_skin,d.theme_scaffold,d.plugin_scaffold],e&&a.isDomEl(l("#update-packs-list"))&&s.update_packs_obj(l("#update-packs-list").attr("rel")),l("input.combobox").on("focus",function(){var o=l(this);o.autocomplete({source:e.data.prog.combo[o.attr("rel")],delay:0,minLength:0,appendTo:o.parent(".tvr-input-wrap"),open:function(e,a){o.next(".combo-arrow").addClass("on")},select:function(e,a){var t;o.val(a.item.value),o.closest(".tvr-input-wrap").addClass("manual-val").find(".comp-style").addClass("hidden").end().find(".combo-arrow").removeClass("on"),"css_unit_set"===o.attr("id")&&(t=o.val(),o.closest("ul").find("input.custom_css_unit").val(t))},search:function(e,a){o.addClass("adjusted-corner-radius")},close:function(e,a){o.removeClass("adjusted-corner-radius").next(".combo-arrow").removeClass("on")}})}),l("span.combo-arrow").on("mousedown",function(){l(this).siblings(".ui-menu").is(":visible")&&(c.wasOpen=!0)}),l("span.combo-arrow").on("click",function(){var e=l(this),a=e.prev();if(c.wasOpen)return e.removeClass("on"),void(c.wasOpen=!1);e.addClass("on"),a.focus().autocomplete("search","")}),l("#tvr").click(function(e){var a,t=l(e.target);try{var o=(o=t.attr("class"))||"tvr-undefined"}catch(e){}0<=o.indexOf("pack-action")||0<=o.indexOf("pack-icon")||0<=o.indexOf("action-text")?(a=t.closest(".pack-action"),c.pack_button_action(a)):0<=o.indexOf("delete-pack-multi")?c.delete_pack(t,"multi"):0<=o.indexOf("download-pack-multi")?c.download_pack(t,"multi"):0<=o.indexOf("combobox")?c.combobox_clicked(t):0<=o.indexOf("delete-file")?c.delete_file(t,e):0<=o.indexOf("show-dialog")?c.show_dialog(t):0<=o.indexOf("show-parent-dialog")?(s.show_dialog(t),"import-from-pack"==t.attr("rel")&&s.set_import_field(t.data("pack-name"))):0<=o.indexOf("close-dialog")||0<=o.indexOf("tvr-dialog")?c.close_dialog(t):0<=o.indexOf("color-img")?c.color_img(t):0<=o.indexOf("fake-checkbox")||0<=o.indexOf("fake-radio")?c.toggle_radio_checkbox(t):0<=o.indexOf("upload-pack")?l("#upload_pack_input").val()||(alert(d.select_zip),e.preventDefault()):0<=o.indexOf("dialog-tab")&&o.indexOf("dialog-tabs")<0&&o.indexOf("dialog-tab-field")<0?c.dialog_tab_pressed(t):0<=o.indexOf("reveal-hidden-form-opts")?c.reveal_form_opts(t):0<=o.indexOf("save-preferences")&&c.save_preferences(t)})},escape_backslashes:function(e,a){return a?e.replace(/%5C/g,"%26%2392%3B"):e.replace(/\\/g,"&#92;")},save_preferences:function(e){var a=l("#ajaxUrl").attr("rel"),t=l("#returnUrl").attr("rel"),o=d.saving_preferences,n=c.escape_backslashes(l("#tvr-preferences").serialize(),!0);c.general_ajax_submission("Preferences save",a,t,o,"POST",n,e)},general_ajax_submission:function(e,a,t,o,n,i,r){r.after(l(s.templates.loaders.default)).clone().removeAttr("id").attr("title",d.saving_preferences),l.ajax({type:n,url:a,data:i,timeout:s.tOut,error:function(e,a){l("img.ajax-loader").remove(),alert(c.handle_ajax_error(e,a))},success:function(){window.location=t}})},reveal_form_opts:function(e){var a=e.attr("rel");e.closest("li").siblings(".hidden."+a).addClass("show")},dialog_tab_pressed:function(e){var a=e.closest(".dialog-main"),t=a.find(".dialog-tabs"),o=e.attr("rel");c.update_tab(a,".dialog-tab-field",t,o,".dialog-tab",".dummy-for-now")},update_tab:function(e,a,t,o,n,i,r){t.find(n).removeClass("active").end().find(n+"-"+o).addClass("active").end().find(i).val(o),r||e.find(a+".show").removeClass("show").end().find(a+"-"+o).addClass("show")},color_img:function(e){l.colorbox({maxWidth:"97%",maxHeight:"90%",href:e.attr("src"),open:!0})},combobox_clicked:function(e){e.autocomplete("search","").next(".combo-arrow").addClass("on")},pack_button_action:function(e){var a=e.attr("rel");"info"==a||"attachments"==a||"instructions"==a?(l("#main-theme-actions").find(".pack-action").removeClass("on"),l("#single-content-areas").find(".manage-content-wrap").removeClass("show"),l("#main-theme-actions").find("li.pack-action-"+a).addClass("on"),l("#edit-"+a).addClass("show")):"download"==a?c.download_pack(e,"single"):"delete"==a&&c.delete_pack(e,"single")},download_pack:function(e,a){var t=l("#zip-folder").attr("rel"),o=e.attr("data-dir-name"),n=t+o+".zip";"single"==a?e.after(l(s.templates.loaders.wbg).attr("id","loading-gif-active")):e.before(l(s.templates.loaders.wbg).attr("id","loading-gif-active"));var i=l("#ajaxUrl").attr("rel")+"&mt_action=tvr_download_pack&dir_name="+o;l.ajax({type:"GET",url:i,async:!0,timeout:2e4,error:function(e,a){var t=l(s.templates.log_item).removeAttr("id");t.find(".short").text("Download failed").end().find(".long").html("<p>"+d.download_failed+"</p><p>"+c.handle_ajax_error(e,a)+"</p>"),l("#full-logs").html('<ul class="logs"></ul>').find("ul").append(t).focus()},success:function(e){var a=l(e).find("#microthemer-notice");"1"===l(e).find("#download-status").attr("rel")?location.href=n:l("#full-logs").html(a.html()).focus()},complete:function(){l("#loading-gif-active").remove()}})},delete_pack:function(o,n){if(!confirm(d.delete_pack_confirm))return!1;"single"==n?o.after(l(s.templates.loaders.wbg).attr("id","loading-gif-active")):o.before(l(s.templates.loaders.wbg).attr("id","loading-gif-active"));var i=o.attr("data-dir-name"),e=l("#ajaxUrl").attr("rel")+"&mt_action=tvr_delete_micro_theme&dir_name="+i,r=l("#delete-ok").attr("rel");l.ajax({type:"GET",url:e,async:!0,timeout:2e4,error:function(e,a){var t=l(s.templates.log_item).removeAttr("id");t.find(".short").text("Delete failed").end().find(".long").html("<p>"+d.delete_pack_failed+"</p><p>"+c.handle_ajax_error(e,a)+"</p>"),l("#full-logs").html('<ul class="logs"></ul>').find("ul").append(t).focus(),l("#loading-gif-active").remove()},success:function(e){var a,t=l(e).find("#microthemer-notice");"1"===l(e).find("#delete-status").attr("rel")?"single"==n?window.location=r:(l("#loading-gif-active").remove(),o.closest("li").fadeOut("slow"),(a=l("li.last-modified")).attr("rel")==i&&a.remove()):l("#full-logs").html(t.html()).focus()},complete:function(){}})},handle_ajax_error:function(e,a){return 0==e.status?d.error_connection:404==e.status?d.error_404:500==e.status?d.error_500:"parsererror"==a?d.error_parser:"timeout"==a?d.error_timeout:d.error_unknown+"\n"+e.responseText},export_zip_button:function(e,a){"warn"==l("span#external-notice").text()&&(confirm(d.external_notice)||a.preventDefault())},delete_file:function(e,a){confirm(d.delete_file_confirm)&&(window.location=e.attr("data-href"))},show_dialog:function(e){c.close_dialog();var a=e.attr("rel");if("not-yet"==a)return!1;var t=e.attr("data-ext"),o=e.attr("data-href")+"?nomtcache="+(new Date).getTime();"view-pack-file"==a&&("image"==t?l.colorbox({maxWidth:"97%",maxHeight:"90%",href:o,open:!0}):jQuery.inArray(t,["txt","json","css","html"])<0?alert(d.view_pack_failed):c.ajax_load_pack_file(e,o))},close_dialog:function(){l("#tvr").find("div.tvr-dialog").removeClass("show")},toggle_radio_checkbox:function(e){var a=e.prev();if(a.is(":checked")){if(e.hasClass("fake-radio"))return!1;a.prop("checked",!1),e.removeClass("on")}else e.hasClass("fake-radio")&&e.closest(".fake-radio-parent").find('input[type="radio"]').prop("checked",!1).end().find(".fake-radio").removeClass("on"),a.prop("checked",!0),e.addClass("on")},ajax_load_pack_file:function(e,o){e.attr("data-base-name");e.after(l(s.templates.loaders.mgbg).attr("id","loading-gif-active")),l.ajax({type:"GET",url:o,async:!1,dataType:"text",timeout:2e4,error:function(e,a){var t=l(s.templates.log_item).removeAttr("id");t.find(".short").text(d.delete_failed).end().find(".long").html("<p>"+d.unable_load+o+"</p><p>"+c.handle_ajax_error(e,a)+"</p>"),l("#full-logs").html('<ul class="logs"></ul>').find("ul").append(t).focus()},success:function(e){var a="#pack-file-content";l(a).html(e),l.colorbox({width:"80%",height:"80%",html:l(a).clone().attr("id","pack-file-content-active"),onClosed:function(){},open:!0})},complete:function(){l("#loading-gif-active").remove()}})}};c.init(),l("#tvr-preferences").click(function(e){var a=l(e.target);try{a.attr("class")}catch(e){}});var o={init:function(){l("#tvr-docs").click(function(e){var a=l(e.target);try{var t=(t=a.attr("class"))||"tvr-undefined"}catch(e){}(0<=t.indexOf("css-group-heading")||0<=t.indexOf("accordion-menu-arrow")||0<=t.indexOf("pg-icon")||0<=t.indexOf("text-for-group"))&&(a=a.closest(".css-group-heading"),o.update_accordion(a,l("#tvr-docs")))})},update_accordion:function(e,a){var t,o=a.find("li.accordion-item"),n=e.parent();return n.hasClass("show-content")&&(t=!0),a.find(".accordion-menu-arrow.on").removeClass("on"),o.slideUp(function(){a.find(".show-content").removeClass("show-content")}),t||(n.find(".accordion-menu-arrow").addClass("on"),e.siblings("li.accordion-item").slideDown(function(){n.addClass("show-content")})),!1}};o.init()});