!function(e,t){var n;"function"==typeof define&&define.amd?define(["module","exports"],t):"undefined"!=typeof exports?t(module,exports):(t(n={exports:{}},n.exports),e.MTautosize=n.exports)}(this,function(e,t){"use strict";var n,o,d="function"==typeof Map?new Map:(n=[],o=[],{has:function(e){return-1<n.indexOf(e)},get:function(e){return o[n.indexOf(e)]},set:function(e,t){-1===n.indexOf(e)&&(n.push(e),o.push(t))},delete:function(e){var t=n.indexOf(e);-1<t&&(n.splice(t,1),o.splice(t,1))}}),u=function(e){return new Event(e,{bubbles:!0})};try{new Event("test")}catch(e){u=function(e){var t=document.createEvent("Event");return t.initEvent(e,!0,!1),t}}function a(e){var t=d.get(e);t&&t.destroy()}function i(e){var t=d.get(e);t&&t.update()}var r=null;"undefined"==typeof window||"function"!=typeof window.getComputedStyle?((r=function(e){return e}).destroy=function(e){return e},r.update=function(e){return e}):((r=function(e,t){return e&&Array.prototype.forEach.call(e.length?e:[e],function(e){return void((r=e)&&r.nodeName&&"TEXTAREA"===r.nodeName&&!d.has(r)&&(l=s=o=null,f=function(){r.clientWidth!==s&&n()},c=function(t){window.removeEventListener("resize",f,!1),r.removeEventListener("input",n,!1),r.removeEventListener("keyup",n,!1),r.removeEventListener("autosize:destroy",c,!1),r.removeEventListener("autosize:update",n,!1),Object.keys(t).forEach(function(e){r.style[e]=t[e]}),d.delete(r)}.bind(r,{height:r.style.height,resize:r.style.resize,overflowY:r.style.overflowY,overflowX:r.style.overflowX,wordWrap:r.style.wordWrap}),r.addEventListener("autosize:destroy",c,!1),"onpropertychange"in r&&"oninput"in r&&r.addEventListener("keyup",n,!1),window.addEventListener("resize",f,!1),r.addEventListener("input",n,!1),r.addEventListener("autosize:update",n,!1),r.style.overflowX="hidden",r.style.wordWrap="break-word",d.set(r,{destroy:c,update:n}),"vertical"===(t=window.getComputedStyle(r,null)).resize?r.style.resize="none":"both"===t.resize&&(r.style.resize="horizontal"),o="content-box"===t.boxSizing?-(parseFloat(t.paddingTop)+parseFloat(t.paddingBottom)):parseFloat(t.borderTopWidth)+parseFloat(t.borderBottomWidth),isNaN(o)&&(o=0),n()));function a(e){var t=r.style.width;r.style.width="0px",r.offsetWidth,r.style.width=t,r.style.overflowY=e}function i(){var e,t;0!==r.scrollHeight&&(e=function(e){for(var t=[];e&&e.parentNode&&e.parentNode instanceof Element;)e.parentNode.scrollTop&&t.push({node:e.parentNode,scrollTop:e.parentNode.scrollTop}),e=e.parentNode;return t}(r),t=document.documentElement&&document.documentElement.scrollTop,r.style.height="",r.style.height=r.scrollHeight+o+"px",s=r.clientWidth,e.forEach(function(e){e.node.scrollTop=e.scrollTop}),t&&(document.documentElement.scrollTop=t))}function n(){i();var e=Math.round(parseFloat(r.style.height)),t=window.getComputedStyle(r,null),n="content-box"===t.boxSizing?Math.round(parseFloat(t.height)):r.offsetHeight;if(n!==e?"hidden"===t.overflowY&&(a("scroll"),i(),n="content-box"===t.boxSizing?Math.round(parseFloat(window.getComputedStyle(r,null).height)):r.offsetHeight):"hidden"!==t.overflowY&&(a("hidden"),i(),n="content-box"===t.boxSizing?Math.round(parseFloat(window.getComputedStyle(r,null).height)):r.offsetHeight),l!==n){l=n;var o=u("autosize:resized");try{r.dispatchEvent(o)}catch(e){}}}var r,t,o,s,l,f,c}),e}).destroy=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],a),e},r.update=function(e){return e&&Array.prototype.forEach.call(e.length?e:[e],i),e}),t.default=r,e.exports=t.default});var MTWindow=!1;window.top.TvrMT?MTWindow=window.top:window.parent.TvrMT?MTWindow=window.parent:window.parent.parent&&window.parent.parent.TvrMT&&(MTWindow=window.parent.parent),jQuery(document).ready(function(E){var e=MTWindow.TvrMT,s=e.TvrUi,k=e.TvrCom,t=(e.tvrsprintf,MTWindow.TvrLang,e.mod.MTsave),n={query:"",category:{serif:1,"sans-serif":1,display:1,handwriting:1,monospace:1},sort:"popularity",subset:""},j={allFonts:{},filteredFonts:[],google:{url:"https://www.googleapis.com/webfonts/v1/webfonts?key=AIzaSyBY_w3-Yj6T54CQP5RNZrruBHEvwenEOmU",filters:E.extend(!0,{},n),adjustments:E.extend(!0,{},{preview_text:"sentence",custom_text:"",font_size:"",variant:"regular"}),pagination:{results_per_page:6,current_page:1,index:0,total_pages:0,total_fonts:0}},typekit:{},preview_text:{sentence:{text:"Grumpy wizards make toxic brew for the evil Queen and Jack.",font_size:32,line_height:1.1},paragraph:{text:"As the minuteness of the parts formed a great hindrance to my speed, I resolved, contrary to my first intention, to make the being of a gigantic stature; that is to say, about eight feet in height, and proportionably large. ",font_size:18,line_height:1.44},alphabet:{text:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghjklmnopqrstuvwxyz ‘?’“!”(%)[#]{@}/&\\<-+÷×=>®©$€£¥¢:;,.*",font_size:24,line_height:1.33},numerals:{text:"1234567890",font_size:58,line_height:1.1},custom:{text:"",font_size:24,line_height:1.33}},init:function(){this.get_font_settings(),this.bind_events(),this.update_filters(),this.fetch_fonts()},bind_events:function(){E("#tvr-fonts").on("change","select",function(e){j.route_event(e,E(this))}).on("input propertychange","input, textarea",function(e){j.route_event(e,E(this))}).on("blur","textarea",function(e){j.route_event(e,E(this))}).on("click",function(e){j.route_event(e,E(this))})},route_event:function(e,t){switch(e.type){case"click":var n=E(e.target);switch(n.data("action")){case"pagination":j.change_pagination(n);break;case"toggle-category":k.toggle_radio_checkbox(n),j.filter_changed(n.prev(),"category");break;case"clear_filters":this.clear_filters(n);break;case"apply_to_all":this.apply_to_all(n);break;case"insert-font":this.insert_font(n);break;case"show-textarea":this.show_textarea(n)}break;case"blur":case"focusout":case"change":case"input":case"propertychange":var o=t,a=o.attr("name");switch(a){case"preview_text":case"variant":case"font_size":j.font_adjusted(o,a);break;case"current_page":j.change_pagination(o);break;case"query":case"sort":case"subset":j.filter_changed(o,a);break;case"font_textarea":"blur"===e.type||"focusout"===e.type?this.hide_textarea(o):j.font_adjusted(o,a)}}},get_font_settings:function(){s.pref&&s.pref.font_config.google&&(this.google=s.pref.font_config.google)},save_font_settings:function(){s.pref&&t.simple_ajax_request({url:s.ajaxUrl+"&save_font_config=google",type:"POST",sendData:t.serialized_data_with_single_key(JSON.stringify(this.google)),plus:"",minus:""})},update_filters:function(){var o=j.google.filters;E("#query-filter").find("input").val(o.query),E("#category-filter").find(".fake-checkbox").each(function(e){var t=E(this),n=t.prev().data("category");o.category[n]?k.check_fake(t):k.uncheck_fake(t)});for(var e=["sort","subset"],t=0;t<e.length;t++){var n=e[t];this.set_select_element(E("#"+n+"-filter"),o[n])}},set_select_element:function(e,t){var n=e.find("select");return(n=k.isDomEl(n)?n:e).find("option").filter(":selected").prop("selected",!1).end().filter('[value="'+t+'"]').prop("selected",!0).attr("selected","selected"),n},fetch_fonts:function(){E.ajax({type:"GET",url:j.google.url,data:j.resolve_api_data(j.google.filters),dataType:"jsonp",async:!0,timeout:s.tOut,error:function(e,t){j.handle_ajax_error(e,t)},success:function(e){j.allFonts=e,j.filter_fonts(),j.load_first_page()}})},show_clear_filters:function(){E("#clear-filters").addClass("show")},hide_clear_filters:function(){E("#clear-filters").removeClass("show")},clear_filters:function(){var e="popularity"!==this.google.filters.sort;this.google.filters=E.extend(!0,{},n),e&&this.fetch_fonts(),this.update_filters(),this.filter_fonts(),this.load_first_page()},show_apply_to_all:function(e){e.find(".apply-to-all").addClass("show")},apply_to_all:function(e){var t=this.google.adjustments,n=e.closest("li"),o=n.find("select[name=variant]").val(),a=n.data("item-number");t.preview_text=n.find("select[name=preview_text]").val(),t.font_size=n.find("input[name=font_size]").val(),t.custom_text="custom"===t.preview_text?n.find("textarea.font").val():"",this.update_display_fonts();var i=(n=E("#output").find("li[data-item-number="+a+"]")).find("select[name=variant]");this.set_select_element(i,o),j.font_adjusted(i,"variant")},getCaretPosition:function(e){var t,n,o,a,i=0;return window.getSelection?(t=window.getSelection()).rangeCount&&(a=t.getRangeAt(0)).commonAncestorContainer.parentNode==e&&(i=a.endOffset):document.selection&&document.selection.createRange&&(a=document.selection.createRange()).parentElement()==e&&(n=document.createElement("span"),e.insertBefore(n,e.firstChild),(o=a.duplicate()).moveToElementText(n),o.setEndPoint("EndToEnd",a),i=o.text.length),i},setSelectionRange:function(e,t,n){var o;e.setSelectionRange?(e.focus(),e.setSelectionRange(t,n)):e.createTextRange&&((o=e.createTextRange()).collapse(!0),o.moveEnd("character",n),o.moveStart("character",t),o.select())},setCaretToPos:function(e,t){this.setSelectionRange(e,t,t)},show_textarea:function(e){var t=e.closest("li"),n=this.getCaretPosition(e[0]),o=t.find("textarea");t.addClass("show-textarea"),MTautosize.update(o),this.setCaretToPos(o[0],n)},hide_textarea:function(e){e.closest("li").removeClass("show-textarea")},font_adjusted:function(e,t){var n=this.google.adjustments,o=(this.google.filters,e.val()),a=e.closest("li"),i=a.find(".font");switch(t){case"preview_text":var r=this.preview_text[o],s=this.get_preview_text(r,n,o);i.text(s).val(s).css({"font-size":r.font_size+"px","line-height":r.line_height}),a.find(".font_size-adjustment").find("input").val(r.font_size);break;case"font_textarea":this.set_select_element(a.find(".preview_text-adjustment").find("select"),"custom"),i.filter("div").text(o);break;case"variant":var l=o.match(/^(\d+)?\s?([a-z]+)?$/),f=l&&l[1]?l[1]:"normal",c=l&&l[2]?l[2]:"normal";return i.css({"font-weight":f,"font-style":c}),!0;case"font_size":i.css("font-size",o+"px")}"font_textarea"!==t&&MTautosize.update(i.filter("textarea")),this.show_apply_to_all(a)},filter_fonts:function(){var e=this.google.filters,t=this.allFonts.items,n=[],o=e.category,a=[],i=e.query.trim().toLowerCase();for(var r in o)o.hasOwnProperty(r)&&o[r]&&a.push(r);for(var s=0;s<t.length;s++){var l=t[s],f=l.family.toLowerCase();e.query&&f.indexOf(i)<0||a.length<5&&!k.in_array(l.category,a)||e.subset&&!k.in_array(e.subset,l.subsets)||n.push(l)}t.length===n.length&&"popularity"===e.sort?this.hide_clear_filters():this.show_clear_filters(),this.filteredFonts=n},filter_changed:function(e,t){var n=this.google.filters,o=e.val(),a=e.closest(".font-filter");switch("category"!==t&&(n[t]=o),t){case"sort":return this.fetch_fonts(),!0;case"category":var i=n[t];a.find("input[type=checkbox]").each(function(e){var t=E(this),n=t.attr("name").match(/\[(.+)\]/)[1];i[n]=t.is(":checked")})}this.filter_fonts(),this.load_first_page()},change_pagination:function(e){var t,n=j.google.pagination,o=e.data("value"),a=(a=E("#current-font-page").val())?parseInt(a):1;switch(o){case"first":t=1;break;case"prev":t=a-1;break;case"manual":t=a;break;case"next":t=a+1;break;case"last":t=n.total_pages}!t||t<1?t=1:t>n.total_pages&&0<n.total_pages&&(t=n.total_pages),n.current_page=t,n.index=(t-1)*n.results_per_page,j.update_pagination(),j.update_display_fonts()},update_pagination:function(){var e=E("#controls"),t=E("#pagination"),n=j.google.pagination;n.total_fonts=this.filteredFonts.length,n.total_pages=Math.ceil(n.total_fonts/n.results_per_page),e.find(".font-count").text(n.total_fonts),t.find(".page-total").text(n.total_pages);var o=E("#current-font-page");o.is(":focus")||o.val(n.current_page),t.find(".control-disabled").removeClass("control-disabled"),n.current_page<=1?t.find(".first-page, .prev-page").addClass("control-disabled"):n.current_page>=n.total_pages&&t.find(".next-page, .last-page").addClass("control-disabled")},load_first_page:function(){var e=E("#current-font-page");e.val(1),this.change_pagination(e)},get_preview_text:function(e,t,n){return"custom"===n?t.custom_text:e.text},update_display_fonts:function(){var e=E("#google-fonts"),t=[],n=j.google.pagination,o=j.google.adjustments,a=j.google.filters,i=n.index,r=n.index+n.results_per_page,s=this.preview_text[o.preview_text],l=this.get_preview_text(s,o,o.preview_text),f=o.font_size?o.font_size:s.font_size,c=this.filteredFonts.slice(i,r),d=E("<ul>"),u=E("#font-entry-template").find("li").clone();u.find(".font").text(l).val(l).css({"font-size":f+"px","line-height":s.line_height}).end().find(".font_size-adjustment").find("input").val(f),this.set_select_element(u.find(".preview_text-adjustment"),o.preview_text);for(var p=0;p<c.length;p++){for(var h=c[p],g=u.clone(!0,!0),_=g.find(".variant-adjustment").find("select"),v=h.variants,m="",y=0;y<v.length;y++){var w=v[y].replace(/italic/g," italic"),x=w,b="regular"===w?'selected="selected"':"";m+='<option value="'+(w=w.replace("regular","400"))+'"'+b+">"+x+"</option>"}_.html(m),v.length<=1&&_.prop("disabled",!0),g.attr("data-item-number",p).find(".font-name").text(h.family).end().find(".font").css("font-family",h.family).end().find(".use-font").data("use-font",h.family),d.append(g);var T=h.variants.length?h.family+":"+h.variants.join(","):h.family;t.push(T)}var z="//fonts.googleapis.com/css?family="+t.join("|").replace(/ /g,"+");z+=a.subset?"&subset="+a.subset:"",k.isDomEl(e)?e.attr("href",z):E("head").append('<link id="google-fonts" rel="stylesheet" type="text/css" href="'+z+'" />'),E("#output").html("").append(d),setTimeout(function(){MTautosize(document.querySelectorAll("textarea"))},100),this.save_font_settings()},resolve_api_data:function(e){var t=[],n=["sort"];for(var o in e)if(e.hasOwnProperty(o)&&k.in_array(o,n)){var a=e[o];if(k.isDefined(a)){if(a===Object(a)){var i=a,r=[];for(var s in i)i.hasOwnProperty(s)&&i[s]&&r.push(s);if(!r.length)continue;a=r.join(",")}t.push(o+"="+a)}}return t.join("&")},insert_font:function(e){var t=[],n=e.closest("li"),o=n.find(".font-name").text(),a=n.find("select[name=variant]").val().trim(),i=E("#controls").find("select[name=subset]").val(),r=!1;a&&"400"!==a&&(t.push(a),r=!0),i&&(r||t.push(a),t.push(i)),t.length&&(o=o+" ("+t.join(", ")+")"),s.insert_google_font&&s.insert_google_font(o)},handle_ajax_error:function(e,t){0==e.status?alert("Connection Error. Request Failed. Please Try again."):404==e.status?alert("Requested URL not found."):500==e.status?alert("Internel Server Error."):"parsererror"==t?alert("Error.\nParsing JSON Request failed."):"timeout"==t?alert("Request Timed out."):alert("Unknow Error.\n"+e.responseText)}};j.init()});